<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Shipments</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">


    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Trirong">

    <style>
        body {
            font-family: "Trirong", serif;
        }

        .top-left-btn {
            position: absolute;
            top: 1%;
            right: 2%;
            background-color: rgb(0, 47, 255);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        .top-left {
            position: absolute;
            top: 0%;
            right: 7%;
            /* background-color: rgb(0, 47, 255); */
            color: rgb(255, 47, 210);
            padding: 10px 20px;
            border: none;
            /* border-radius: 5px; */
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
    <script>
        // setInterval(function () { window.location.reload(); }, 15000);
        getShipments();

        function getShipments() {
            const email = localStorage.getItem('email');
            console.log(email);
            const token = localStorage.getItem('access_token');
            console.log(token)
            var myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);
            myHeaders.append("Content-Type", "application/json");
            const url = `http://localhost:8081/shipment/find?email=${email}`;
            console.log(url);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch(url, requestOptions)
                .then(response => {
                    if (response.ok) {
                        return response.json(); // Parse response as JSON
                    } else {
                        throw new Error('No records found.');
                    }
                })
                .then(result => {
                    const tableBody = document.querySelector("#deviceTable tbody");
                    const errorMessage = document.querySelector("#errorMessage");

                    // Clear the existing table rows and error message
                    tableBody.innerHTML = "";
                    errorMessage.innerHTML = "";

                    // Loop through the result array and create table rows
                    result.forEach(shipment => {
                        const row = document.createElement("tr");

                        // Create and populate cells for each shipment property
                        // ...
                        const shipmentNumberCell = document.createElement("td");
                        shipmentNumberCell.textContent = shipment.shipmentNumber;
                        row.appendChild(shipmentNumberCell);

                        const containerNumberCell = document.createElement("td");
                        containerNumberCell.textContent = shipment.containerNumber;
                        row.appendChild(containerNumberCell);

                        const descriptionCell = document.createElement("td");
                        descriptionCell.textContent = shipment.descripton;
                        row.appendChild(descriptionCell);

                        const routeCell = document.createElement("td");
                        routeCell.textContent = shipment.route;
                        row.appendChild(routeCell);

                        const goodsCell = document.createElement("td");
                        goodsCell.textContent = shipment.goods;
                        row.appendChild(goodsCell);

                        const countryCell = document.createElement("td");
                        countryCell.textContent = shipment.country;
                        row.appendChild(countryCell);

                        const deliveryDateCell = document.createElement("td");
                        deliveryDateCell.textContent = shipment.deliveryDate;
                        row.appendChild(deliveryDateCell);

                        const poNumberCell = document.createElement("td");
                        poNumberCell.textContent = shipment.pONumber;
                        row.appendChild(poNumberCell);

                        const deliveryNumberCell = document.createElement("td");
                        deliveryNumberCell.textContent = shipment.deliveryNumber;
                        row.appendChild(deliveryNumberCell);

                        const ndcNumberCell = document.createElement("td");
                        ndcNumberCell.textContent = shipment.nDCNumber;
                        row.appendChild(ndcNumberCell);

                        const batchIdCell = document.createElement("td");
                        batchIdCell.textContent = shipment.batchId;
                        row.appendChild(batchIdCell);

                        const serialNumberCell = document.createElement("td");
                        serialNumberCell.textContent = shipment.serialNumberOfGoods;
                        row.appendChild(serialNumberCell);

                        // const emailCell = document.createElement("td");
                        // emailCell.textContent = shipment.email;
                        // row.appendChild(emailCell);

                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    const errorMessage = document.querySelector("#errorMessage");
                    errorMessage.textContent = error.message;
                });
        }
    </script>

</head>

<body style="background-image: url(https://thumbs.dreamstime.com/b/yangshan-port-shanghai-international-deep-water-china-sunny-day-stacked-containers-218662760.jpg);background-attachment: fixed;
background-repeat: no-repeat;
background-size: cover;
height: 100vh;
place-items: center;;">
 <script>
    const mail = localStorage.getItem('email');
    if(mail==null){
     window.location.href = "./index.html";
    }

 </script>
    <div>
        <p class="top-left" id="email"></p>

    </div>
    <a class="top-left-btn" href="/index.html">Signout</a>
    <div class="bg">
        <div>


        </div>
        <div class=" m-5  ">

            <h3 style="text-align: center ">My Shipments</h3>
        </div>
        <div class="container ">
            <div>
                <div class="table-wrapper-scroll-y my-custom-scrollbar">

                    <table class="table" id="deviceTable">
                        <thead class="table-primary table-bordered ">
                            <tr>

                                <th>shipment No</th>
                                <th>container No</th>
                                <th>descripton</th>
                                <th>route</th>
                                <th>goods</th>
                                <th>country</th>
                                <th>deliveryDate</th>
                                <th>pONumber</th>
                                <th>delivery No</th>
                                <th>nDCNumber</th>
                                <th>batchId</th>
                                <th>S.No OfGoods</th>
                                <!-- <th>email</th> -->
                            </tr>
                        </thead>

                        <tbody>


                        </tbody>
                        <div id="errorMessage"></div>
                    </table>

                </div>

            </div>

        </div>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/rowreorder/1.2.8/js/dataTables.rowReorder.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script>
        const email = localStorage.getItem('email');
        document.getElementById('email').innerText = email;
    </script>

</body>

</html>